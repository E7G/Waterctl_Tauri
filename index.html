<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="深圳市常工电子“蓝牙水控器”控制程序的开源实现。适用于国内各大高校宿舍热水器。" />
    <meta name="theme-color" content="#fafafa" />
    <link rel="apple-touch-icon" href="logo192.png" />
    <!-- <link rel="manifest" href="manifest.json" /> -->
    <title>蓝牙水控器 FOSS</title>
  </head>

  <body>
    <div class="main supported">
      <noscript>需要启用 JavaScript。</noscript>
      <button id="main-button" style="margin: 0%">开启</button>
      <p id="device-name" style="margin-top: 10px; margin-bottom: 10px">未连接</p>
      <p id="counter" style="margin-top: 10px; margin-bottom: 10px" class="low-time">
        剩余时间：00:00
      </p>
    </div>
    <div class="main unsupported">
      <h3>不支持的浏览器</h3>
      <p>需要支持蓝牙的浏览器，如 Chrome 或 Edge。</p>
      <p>
        <a href="https://github.com/celesWuff/waterctl/blob/2.x/FAQ.md" target="_blank"><button>查看支持列表</button></a>
      </p>
    </div>

    <!-- <div class="misc">
      <button id="install-button" hidden>将蓝牙水控器 FOSS 安装到系统</button>
      <p style="font-size: smaller; color: gray; margin: 0%">
        <a href="https://github.com/celesWuff/waterctl" target="_blank">源代码</a> ·
        <a href="https://github.com/celesWuff/waterctl/blob/2.x/FAQ.md" target="_blank">疑难解答</a>
        <span id="version"></span>
        <br />
        <span style="font-size: smaller">copyright (c) 2024 celesWuff, licensed under MIT License</span>
      </p>
    </div> -->

    <dialog id="dialog">
      <header>出现错误</header>
      <form method="dialog">
        <p id="dialog-content"></p>
        <pre id="dialog-debug-container"><code id="dialog-debug-content"></code></pre>
        <menu style="display: flex; justify-content: flex-end">
          <button onclick="succeeded = false">好</button>
        </menu>
      </form>
    </dialog>

    <dialog id="settings-dialog">
      <header>设置</header>
      <form method="dialog" id="settings-form" style="display: flex; flex-direction: column; height: 80vh; max-height: 600px;">
        <div style="overflow-y: auto; flex: 1; padding: 20px;">
          <div class="settings-section">
            <label for="device-name-input" class="settings-label">设备名称</label>
            <input type="text" id="device-name-input" name="deviceName" class="settings-input">
          </div>
          
          <div class="settings-section">
            <h3 class="settings-group-title">超时配置 (毫秒)</h3>
            <div class="settings-grid">
              <div class="settings-item">
                <label for="reconnect-delay" class="settings-sublabel">重连延迟</label>
                <input type="number" id="reconnect-delay" name="reconnectDelay" min="100" max="5000" step="100" class="settings-number">
              </div>
              <div class="settings-item">
                <label for="dialog-close-delay" class="settings-sublabel">错误对话框关闭延迟</label>
                <input type="number" id="dialog-close-delay" name="dialogCloseDelay" min="1000" max="10000" step="500" class="settings-number">
              </div>
              <div class="settings-item">
                <label for="data-cleanup-delay" class="settings-sublabel">数据清理延迟</label>
                <input type="number" id="data-cleanup-delay" name="dataCleanupDelay" min="1000" max="10000" step="500" class="settings-number">
              </div>
              <div class="settings-item">
                <label for="operation-timeout" class="settings-sublabel">操作超时时间</label>
                <input type="number" id="operation-timeout" name="operationTimeout" min="5000" max="30000" step="1000" class="settings-number">
              </div>
              <div class="settings-item">
                <label for="scan-timeout" class="settings-sublabel">扫描超时时间</label>
                <input type="number" id="scan-timeout" name="scanTimeout" min="5000" max="30000" step="1000" class="settings-number">
              </div>
            </div>
          </div>
          
          <div class="settings-section">
            <label class="settings-checkbox-label">
              <input type="checkbox" id="auto-reconnect" name="autoReconnect">
              <span>自动重连（关闭后与原版行为一致）</span>
            </label>
          </div>
        </div>
        
        <menu style="display: flex; justify-content: flex-end; gap: 10px; margin: 0; padding: 15px; border-top: 1px solid #eee;">
          <button type="button" onclick="resetSettings()">恢复默认</button>
          <button type="submit">保存</button>
          <button type="button" onclick="document.getElementById('settings-dialog').close()">取消</button>
        </menu>
      </form>
    </dialog>

    <div style="position: fixed; bottom: 10px; left: 10px;">
      <a href="#" id="settings-link" class="settings-link">设置</a>
    </div>
  </body>

  <script type="module" src="/src/index.ts"></script>
</html>